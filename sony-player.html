<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HLS Player Embed</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Plyr -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

    <!-- HLS -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        /* ===============================
           RESET & BASE
        =============================== */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #000;
            overflow: hidden;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        /* ===============================
           PLAYER CONTAINER
        =============================== */
        .plyr {
            width: 100%;
            height: 100%;
            background: radial-gradient(
                1200px 600px at top,
                #0b1020,
                transparent
            ), #000;
        }

        video {
            width: 100%;
            height: 100%;
            background: #000;
        }

        /* ===============================
           PREMIUM CONTROLS (SAFE)
        =============================== */
        .plyr--video .plyr__controls {
            background: linear-gradient(
                to top,
                rgba(0,0,0,.85),
                rgba(0,0,0,.55),
                transparent
            );
            backdrop-filter: blur(10px);
            padding-top: 14px;
        }

        .plyr__control {
            color: #fff;
        }

        .plyr__control:hover {
            background: rgba(255,255,255,.12);
        }

        .plyr__progress input[type=range] {
            color: #00e5ff;
        }

        .plyr__volume input[type=range] {
            color: #00e5ff;
        }

        .plyr__control--overlaid {
            background: rgba(0,0,0,.65);
            backdrop-filter: blur(8px);
            box-shadow: 0 10px 30px rgba(0,0,0,.7);
        }

        /* ===============================
           MOBILE SAFE AREA
        =============================== */
        @supports (padding: max(0px)) {
            .plyr--video .plyr__controls {
                padding-bottom: max(env(safe-area-inset-bottom), 12px);
            }
        }

        /* ===============================
           UNMUTE OVERLAY (VISUAL ONLY)
           (Your JS controls behavior)
        =============================== */
        #unmute-overlay {
            backdrop-filter: blur(6px);
            box-shadow: 0 10px 25px rgba(0,0,0,.6);
        }

        /* ===============================
           AUTOPLAY MESSAGE
        =============================== */
        .plyr__poster {
            background-size: cover;
        }
    </style>
</head>

<body>

    <!-- VIDEO ELEMENT (UNCHANGED) -->
    <video id="player" playsinline>
        <source src="" type="application/vnd.apple.mpegurl" />
        <a href="" download>Download</a>
    </video>

    <!-- CONFIG (UNCHANGED) -->
    <script type="application/json" id="embed-config">{
        "autoplay": false,
        "muted": false,
        "hidecontrols": false
    }</script>

    <!-- ===============================
         YOUR ORIGINAL JS — UNTOUCHED
         =============================== -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('player');
            let hasUserInteracted = false;
            let isAutoplayMuted = false;
            let autoplayAttempted = false;
            
            const configElement = document.getElementById('embed-config');
            const config = JSON.parse(configElement.textContent);
            
            const plyrOptions = {
                captions: { active: true, update: true, language: 'en' }
            };
            
            if (config.hidecontrols) {
                plyrOptions.controls = [];
            } else {
                plyrOptions.controls = ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'];
            }
            
            if (config.muted) {
                plyrOptions.muted = true;
            }
            
            const player = new Plyr(video, plyrOptions);
            
            const videoUrl = '';
            let hls = null;

            if (Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(videoUrl);
                hls.attachMedia(video);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    if (config.autoplay) {
                        setTimeout(() => {
                            attemptSmartAutoplay();
                        }, 100);
                    } else if (config.muted) {
                        player.muted = true;
                        video.muted = true;
                    }
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = videoUrl;
                
                video.addEventListener('loadedmetadata', function() {
                    if (config.autoplay) {
                        setTimeout(() => {
                            attemptSmartAutoplay();
                        }, 100);
                    } else if (config.muted) {
                        player.muted = true;
                        video.muted = true;
                    }
                });
            }
            
            async function attemptSmartAutoplay() {
                if (autoplayAttempted) return;
                autoplayAttempted = true;
                
                try {
                    player.muted = false;
                    const playPromise = player.play();
                    if (playPromise && typeof playPromise.then === 'function') {
                        await playPromise;
                        return;
                    }
                } catch {}
                
                try {
                    player.muted = true;
                    isAutoplayMuted = true;
                    const mutedPlayPromise = player.play();
                    if (mutedPlayPromise && typeof mutedPlayPromise.then === 'function') {
                        await mutedPlayPromise;
                        showUnmuteHint();
                        return;
                    }
                } catch {
                    showAutoplayBlockedMessage();
                }
            }
            
            function showUnmuteHint() {
                const unmuteBtn = document.createElement('div');
                unmuteBtn.id = 'unmute-overlay';
                unmuteBtn.style.cssText = `
                    position:absolute;
                    top:16px;
                    right:16px;
                    width:40px;
                    height:40px;
                    background:rgba(0,0,0,.8);
                    border-radius:10px;
                    display:flex;
                    align-items:center;
                    justify-content:center;
                    cursor:pointer;
                    z-index:1000;
                `;
                
                unmuteBtn.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                        <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63z"/>
                    </svg>
                `;
                
                const container = player.elements.container;
                container.style.position = 'relative';
                container.appendChild(unmuteBtn);
                
                unmuteBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    forceUnmute();
                });
            }
            
            function showAutoplayBlockedMessage() {
                const messageElement = document.createElement('div');
                messageElement.style.cssText = `
                    position:absolute;
                    top:50%;
                    left:50%;
                    transform:translate(-50%,-50%);
                    background:rgba(0,0,0,.8);
                    color:white;
                    padding:12px 16px;
                    border-radius:8px;
                    font-size:14px;
                    z-index:1000;
                `;
                messageElement.innerHTML = '▶ Click to play<br><small>Autoplay blocked</small>';
                player.elements.container.appendChild(messageElement);
                setTimeout(() => messageElement.remove(), 3000);
            }
            
            function forceUnmute() {
                player.muted = false;
                video.muted = false;
                player.volume = 1;
                video.volume = 1;
                const overlay = document.getElementById('unmute-overlay');
                if (overlay) overlay.remove();
                hasUserInteracted = true;
                isAutoplayMuted = false;
            }
        });
    </script>

</body>
</html>
